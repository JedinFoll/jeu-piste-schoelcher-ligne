<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jeu de Piste ‚Äì Sch≈ìlcher</title>
<link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&display=swap" rel="stylesheet">
<style>
  :root{
    --ink:#f5f0e6; --marron:#5a2e0c; --marron-light:#7a3e21; --marron-dark:#2d1405;
    --parch:#fffdf4; --frame:#a97442; --shadow:rgba(0,0,0,.4);
  }
  *{box-sizing:border-box}
  body{font-family:'Trebuchet MS',Arial,sans-serif;background:var(--marron);margin:0;padding:24px;line-height:1.6;color:var(--ink)}
  .hero{background:var(--marron-light);border:3px solid var(--frame);border-radius:12px;padding:18px;margin-bottom:18px;box-shadow:4px 4px 8px var(--shadow)}
  .hero h1{font-family:'Alfa Slab One',serif;color:#f5e1c4;text-shadow:2px 2px 0 var(--marron-dark);margin:0 0 .5rem}
  .hero p{margin:.25rem 0 0;color:#f0e6d2}

  .card{background:var(--parch);border:2px solid var(--frame);border-radius:12px;padding:18px;margin-top:16px;color:#2d1a0a;box-shadow:3px 3px 6px var(--shadow)}
  h2{font-family:'Alfa Slab One',serif;color:var(--marron-dark)}
  .row{display:flex;gap:.6rem;flex-wrap:wrap;margin:.4rem 0 1rem}
  .btn{display:inline-block;padding:10px 16px;border-radius:8px;text-decoration:none;font-weight:700;border:2px solid var(--frame);background:#d4a373;color:#2d1a0a;cursor:pointer;box-shadow:2px 2px 4px var(--shadow);transition:transform .18s,background .18s,color .18s}
  .btn:hover{background:#b97d4e;color:#fffbea;transform:scale(1.05)}
  .btn.primary{background:var(--marron-light);color:#fffbea;border-color:var(--marron-dark)}
  .btn.primary:hover{background:var(--marron-dark)}
  input[type=text]{padding:10px 12px;border:2px solid var(--frame);border-radius:10px;min-width:220px;background:#fff;color:#2d1a0a}
  .badge{display:inline-block;padding:.25rem .5rem;border-radius:.5rem;border:2px solid #ccc;font-size:.85rem}
  .ok{background:#e9fbe9;border-color:#bfe9bf;color:#164a16}
  .ko{background:#fff0f0;border-color:#f2c1c1;color:#7b1a1a}

  .map-wrap{position:relative;width:100%;overflow:auto;background:#faf3e0;border:2px solid #a97442;border-radius:12px}
  .map-frame{width:100%;height:min(80vh,700px);display:flex;align-items:center;justify-content:center}
  .map-img{max-height:100%;max-width:100%;display:block;border-radius:8px}
  .map-tools{position:absolute;right:12px;top:12px;display:flex;gap:6px}

  .hr{height:2px;margin:16px 0;background:#7a3e21}
  .enigme{display:none}

  /* Chrono + classement */
  .hud{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .chip{background:#fff0cc;border:2px solid #e2b24c;border-radius:999px;padding:6px 12px;font-weight:700}
  table{width:100%;border-collapse:collapse;margin-top:.5rem}
  th,td{padding:8px;border-bottom:1px solid #e4d6bd;text-align:left}
  th{background:#f7ead0}
  .sms-hint{background:#fff4d6;border:2px dashed #c28b2c;border-radius:10px;padding:10px;margin-top:6px;color:#2d1a0a}
</style>
</head>
<body>
  <div class="hero">
    <h1>Jeu de Piste ‚Äì Sch≈ìlcher</h1>
    <p>Munis-toi de papier et crayon, scanne les QR codes et r√©sous les √©nigmes.</p>
  </div>

  <!-- Acc√®s -->
  <section class="card" id="acces">
    <h2>Acc√®s au jeu</h2>

    <!-- Paiement -->
    <div class="row">
      <a class="btn primary" target="_blank" rel="noopener"
         href="https://www.paypal.com/ncp/payment/GLM2FB7ERYXKQ">üí≥ Payer 10 ‚Ç¨ (PayPal)</a>
    </div>

    <!-- Envoi SMS -->
    <div class="row">
      <input type="text" id="payerName" value="INARI" readonly />
      <input type="text" id="payerTxn" placeholder="N¬∞ de paiement PayPal" />
      <!-- Lien SMS -->
      <a id="btnEnvoyerSMS" class="btn" href="#">Envoyer la preuve par SMS</a>
    </div>
    <div id="smsHint" class="sms-hint" style="display:none;"></div>

    <!-- Entr√©e du code -->
    <div class="row">
      <input type="text" id="codeInput" placeholder="Entrer le code d‚Äôacc√®s re√ßu" />
      <button class="btn" id="btnValiderCode">Valider le code</button>
    </div>

    <!-- Pseudo + HUD -->
    <div class="row hud">
      <input type="text" id="playerName" placeholder="Ton pseudo (obligatoire)" />
      <span class="chip">‚è± Temps : <span id="chrono">00:00:00</span></span>
      <span>Statut : <span id="badge" class="badge ko">verrouill√©</span></span>
    </div>

    <div class="hr"></div>
    <div class="row">
      <button class="btn primary" id="btnCommencer" disabled>Commencer le jeu</button>
      <button class="btn" id="btnScanner" disabled>Scanner le QR code</button>
    </div>
  </section>

  <!-- Carte -->
  <section class="card">
    <h2>Carte du parcours</h2>
    <div class="map-wrap">
      <div class="map-tools">
        <a class="btn" download href="carte-schoelcher.jpg">T√©l√©charger</a>
      </div>
      <div class="map-frame">
        <img class="map-img" id="mapImg" src="carte-schoelcher.jpg" alt="Carte du jeu de piste √† Sch≈ìlcher">
      </div>
    </div>
  </section>

  <!-- √ânigmes -->
  <section id="bloc-enigmes" class="card" style="display:none;">
    <h2>√ânigmes</h2>
    <p id="txtVisibility">Seule l‚Äô√ânigme 1 est visible au d√©part. Pour d√©bloquer les suivantes, scanne les bons QR codes dans l‚Äôordre.</p>

    <article id="enigme1" class="enigme"><h3>√ânigme 1</h3><p><em>(Ton √âNIGME 1 ici)</em></p></article>
    <article id="enigme2" class="enigme"><h3>√ânigme 2</h3><p><em>(Ton √âNIGME 2 ici)</em></p></article>
    <article id="enigme3" class="enigme"><h3>√ânigme 3</h3><p><em>(Ton √âNIGME 3 ici)</em></p></article>
    <article id="enigme4" class="enigme"><h3>√ânigme 4</h3><p><em>(Ton √âNIGME 4 ici)</em></p></article>
    <article id="fin" class="enigme"><h3>Bravo üéâ</h3><p>Tu as termin√© le parcours !</p></article>
  </section>

  <!-- Classement -->
  <section class="card" id="classement">
    <h2>Classement ‚Äì Top 5</h2>
    <table id="boardTable">
      <thead><tr><th>#</th><th>Pseudo</th><th>Temps</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

<script>
  const CONTACT_PHONE = "+596696327693";
  const ACCESS_CODE   = "SCHOELCHER-10";

  const badge = document.getElementById("badge");
  const btnCommencer = document.getElementById("btnCommencer");
  const btnScanner   = document.getElementById("btnScanner");
  const blocEnigmes  = document.getElementById("bloc-enigmes");
  const codeInput    = document.getElementById("codeInput");
  const btnValiderCode = document.getElementById("btnValiderCode");
  const playerNameInput = document.getElementById("playerName");
  const chronoEl     = document.getElementById("chrono");

  // Chrono
  let startTime=null, timerInterval=null;
  const pad=x=>String(x).padStart(2,"0");
  const fmt=sec=>`${pad(Math.floor(sec/3600))}:${pad(Math.floor((sec%3600)/60))}:${pad(Math.floor(sec%60))}`;
  function tick(){chronoEl.textContent=fmt(Math.floor((Date.now()-startTime)/1000));}
  function startChrono(){if(timerInterval)clearInterval(timerInterval);startTime=Date.now();timerInterval=setInterval(tick,1000);tick();}
  function stopChrono(){if(!startTime)return;clearInterval(timerInterval);timerInterval=null;}

  // Classement
  function renderBoard(){/* m√™me logique que plus haut */}
  renderBoard();

  // Acc√®s
  function setAccess(ok){if(ok){badge.textContent="d√©verrouill√©";badge.classList.remove("ko");badge.classList.add("ok");updateStartButton();}else{badge.textContent="verrouill√©";badge.classList.remove("ok");badge.classList.add("ko");btnCommencer.disabled=true;btnScanner.disabled=true;blocEnigmes.style.display="none";}}
  setAccess(false);

  function updateStartButton(){btnCommencer.disabled=!(playerNameInput.value.trim());}
  playerNameInput.addEventListener("input",updateStartButton);

  // Code
  btnValiderCode.addEventListener("click",()=>{if(codeInput.value.trim()===ACCESS_CODE){setAccess(true);alert("Code valide ‚úÖ");}else alert("Code invalide ‚ùå");});

  // Commencer
  btnCommencer.addEventListener("click",()=>{if(btnCommencer.disabled)return;blocEnigmes.style.display="block";document.getElementById("enigme1").style.display="block";btnScanner.disabled=false;if(!startTime)startChrono();});

  // SMS
  const btnEnvoyerSMS=document.getElementById("btnEnvoyerSMS");
  const payerTxn=document.getElementById("payerTxn");
  const smsHint=document.getElementById("smsHint");
  const isIOS=/iPhone|iPad|iPod/i.test(navigator.userAgent);
  const isAndroid=/Android/i.test(navigator.userAgent);
  function buildSmsMessage(){const txn=(payerTxn.value||"").trim();if(!txn){alert("Entre ton N¬∞ de paiement PayPal.");return null;}return `INARI - Paiement: ${txn}`;}
  function smsHref(phone,text){const num=phone.replace(/\s+/g,'');const body=encodeURIComponent(text);if(isIOS)return `sms:${num}&body=${body}`;if(isAndroid)return `smsto:${num}?body=${body}`;return `sms:${num}?body=${body}`;}
  btnEnvoyerSMS.addEventListener("click",(e)=>{const msg=buildSmsMessage();if(!msg){e.preventDefault();return;}btnEnvoyerSMS.setAttribute("href",smsHref(CONTACT_PHONE,msg));setTimeout(()=>{if(document.visibilityState==="visible"){smsHint.style.display="block";smsHint.innerHTML=`Si l‚Äôapp SMS ne s‚Äôest pas ouverte, envoie manuellement au <strong>${CONTACT_PHONE}</strong> :<br><pre>${msg}</pre>`;}},1200);});
</script>
</body>
</html>
